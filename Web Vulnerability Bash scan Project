#!/bin/bash 
## Web vulnerability bash script scanner project Mekhi M. Garcia,1308
#Use if statements to check for nmap install
if ! command -v nmap &> /dev/null
then 
    echo "nmap installation is not on the system attempting install..."
     sudo apt install nmap -y
else 
    echo "nmap has already been installed.."
fi
#Proceed with nmap scan 
if [ -z "$1" ]; then 
    read -p "Enter Target IP Adress:" IPAddress
    else
    IPAddress="$1"
 fi
 if [ -z "$IPAddress" ]; then 
   echo "Error no Target or address provided"
   exit 119
   fi 

  echo "Select option for nmap scan for $IPAddress:"
    echo "1. Quick Scan (-F)"
     echo "2. Service Version Detection (-sV)"
      echo "3. Agressive scan (-A)"
       echo "4. Skip Host Discovery (-Pn)" 
        echo "5.Specified Port scan (-p )"
        read -p "Select an option (1-5): " Scan_Options 
      
       NMAP_OPTIONS="" 
      case $Scan_Options in
          1)
              NMAP_OPTIONS="-F" #fast scan
              ;;
          2)
            NMAP_OPTIONS="-sV" #service version detection
            ;;
          3)
          NMAP_OPTIONS="-A" # Agressive scan
          ;;
          4)
          NMAP_OPTIONS="-Pn" #scan exclude discovery
          ;;
          5)
            read -p "Enter ports to scan (80,443,22, or 1-10244): " PORTS
            if [ -z "$PORTS" ]; then
            echo "Error a port has not been selected"
             exit 120
            fi
            NMAP_OPTIONS=" -p $PORTS"
            ;;
          *)
        echo "Invalid Selection. Exiting."
        exit 121
        ;;
      esac
    #execute the nmap scan 
    Output_File="nmap_scan_results_${IPAddress}.txt"
    echo "Initializing nmap scan on $IPAddress with selected options: $NMAP_OPTIONS" 
    echo "scan results redirected to $Output_File for review..."
     nmap $NMAP_OPTIONS $IPAddress -oN $Output_File
